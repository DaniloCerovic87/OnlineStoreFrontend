<main>
  <div class="p-4">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold mb-4">Products ({{ products.length }})</h1>
      @if (isAuthenticated) {
        <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 ml-4"
                (click)="goToCreateProductPage()">
          Create Product
        </button>
      }
    </div>
    @if (products.length > 0) {
      <ul class="list-disc list-inside">
        @for (product of products; track product.id) {
          <li class="mb-2 p-4 bg-gray-100 rounded-lg shadow-sm list-none">
            <form #itemForm="ngForm"
                  (ngSubmit)="orderProduct(product, qty, itemForm)"
                  class="flex items-center gap-4">

              <div class="flex-1">
                <div class="font-semibold">{{ product.name }}</div>
                <div class="text-gray-600">Price: {{ product.price }}</div>

                <label class="mt-1 block">
                  Quantity:
                  <input type="number"
                         class="border rounded px-2 py-1 ml-2 w-24"
                         name="quantity-{{ product.id }}"
                         ngModel
                         #qty="ngModel"
                         required
                         min="1"
                         (blur)="clearInlineErrors()"/>
                </label>
                @if (itemForm.submitted && qty.invalid && showSubmitError) {
                  <div class="text-red-500 text-sm">
                    Quantity must be at least 1
                  </div>
                }
              </div>

              <button type="submit"
                      class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                Order Now
              </button>
              <button type="button"
                      class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                      (click)="deleteProduct(product.id)"
              >
                Delete
              </button>
            </form>
          </li>
        }
      </ul>
    } @else if (products.length === 100) {
      <span class="text-sm text-gray-700">
      Click <a class="text-blue-500 hover:underline cursor-pointer">Load More</a> to see more products
    </span>
    } @else {
      <p class="text-red-500 font-semibold">No products found!</p>
    }
  </div>
</main>
